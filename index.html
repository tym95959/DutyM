<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leeli Alerts</title>
<link rel="manifest" href="manifest.json">
</head>
<body>
<h2>Leeli Announcement App</h2>
<p>Install this app to receive live announcements!</p>
<script type="module">
import { messaging } from './dcfire.js';
import { getToken, onMessage } from "https://www.gstatic.com/firebasejs/10.3.0/firebase-messaging.js";

// Request permission for notifications
Notification.requestPermission().then(permission => {
    if(permission === "granted"){
        console.log("Notification permission granted.");
        getToken(messaging, { vapidKey: 'BCMEhQHZvwuii0Pul11PRfM68N_C4iox9c6jUwWoj21lvKZ2hhAfRe-5KwG_A1xMsQ04aelb8XM7x-mXNYzak1o' })
        .then((currentToken) => {
            if(currentToken){
                console.log("FCM Token:", currentToken);
                // TODO: save this token to your database if you want to target specific users
            } else {
                console.log('No registration token available.');
            }
        }).catch(console.error);
    }
});

// Listen to foreground messages
onMessage(messaging, (payload) => {
    console.log('Message received. ', payload);
    const notificationTitle = payload.notification.title;
    const notificationOptions = {
        body: payload.notification.body,
        icon: '/icon.png'
    };
    new Notification(notificationTitle, notificationOptions);
});
</script>
<script src="sw-register.js"></script>
</body>
</html>
